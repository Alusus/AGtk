اشمل "مـحا.أسس"؛
مـحا.اشمل_ملف("Alusus/Gtk", "جـتك.أسس")؛
اشمل "بـناء.أسس"؛
اشمل "مـتم/طـرفية.أسس"؛
اشمل "مـتم/نـص.أسس"؛

@تصدير[exit] دالة اخرج(صحيح)؛

وحدة مـضروب {
  دالة مضروب (م: صحيح[64]): صحيح[64] {
    إذا م <= 0 أرجع 1 وإلا أرجع م * مضروب(م - 1)؛
  }؛
  
  دالة اختبر_المضروب (): ثـنائي {
    إذا مضروب(5) != 120 أرجع 0؛
    إذا مضروب(0) != 1 أرجع 0؛
    أرجع 1؛
  }؛
}؛

وحدة واجـهة {
  عرف النافذة: مؤشر[جـتك.نـافذة_تطبيق]؛

  @تصدير[main]
  دالة ابدأ {
    عرف التطبيق: مؤشر[جـتك.تـطبيق]؛
    عرف الحالة: صحيح؛
    عرف معرف_التطبيق: "org.alusus.gtk-factorial"؛
    التطبيق = جـتك.تـطبيق.أنشئ(معرف_التطبيق، 0)؛
    جـلب.اربط_إشارة(التطبيق، جـتك.إشـارة._تفعيل_، فعّل~مؤشر~مثل[مؤشر[دالة]]، 0، 0، 0)؛
    الحالة = جـتك.تـطبيق.شغل(التطبيق، 0، 0)؛
    جـلب.حرر(التطبيق)؛
  }؛

  دالة فعّل (تطبيق: مؤشر[جـتك.تـطبيق]، معلومات: مؤشر) {
    عرف صندوق: مؤشر[جـتك.صـندوق]؛
    عرف لصيقة: مؤشر[جـتك.لـصيقة]؛
    عرف حقل: مؤشر[جـتك.حـقل]؛
    عرف صندوق_الأزرار: مؤشر[جـتك.صـندوق_أزرار]؛
    عرف زر_حول: مؤشر[جـتك.الـزر]؛
    عرف زر_الخروج: مؤشر[جـتك.الـزر]؛

    النافذة = جـتك.نـافذة_تطبيق.أنشئ(تطبيق)؛
    جـتك.نـافذة.عين_عنوانا(النافذة، "الأسس/وحدة جـتك: المضروب")؛
    جـتك.نـافذة.عين_الحجم_المبدئي(النافذة، 480، 320)؛

    صندوق = جـتك.صـندوق.أنشئ(جـتك.اتـجاه._عمودي_، 20)؛

    لصيقة = جـتك.لـصيقة.أنشئ("بسم الله الرحمن الرحيم")؛

    حقل = جـتك.حـقل.أنشئ()؛
    جـلب.اربط_إشارة(حقل، جـتك.إشـارة._تغير_، قد_تغير_الحقل~مؤشر~مثل[مؤشر[دالة]]، لصيقة، 0، 0)؛

    صندوق_الأزرار = جـتك.صـندوق_أزرار.أنشئ(جـتك.اتـجاه._أفقي_)؛
    جـتك.صـندوق_أزرار.عين_النسق(صندوق_الأزرار، جـتك.طـراز_صندوق_الأزرار._انتشار_)؛

    زر_حول = جـتك.الـزر.أنشئ_بلصيقة("حول")؛
    جـلب.اربط_إشارة(زر_حول، جـتك.إشـارة._نقر_، قد_نقر_زر_حول~مؤشر~مثل[مؤشر[دالة]]، 0، 0، 0)؛
    جـتك.حـاوية.أضف(صندوق_الأزرار، زر_حول)؛

    زر_الخروج = جـتك.الـزر.أنشئ_بلصيقة("خروج")؛
    جـلب.اربط_إشارة(زر_الخروج، جـتك.إشـارة._نقر_، قد_نقر_زر_الخروج~مؤشر~مثل[مؤشر[دالة]]، 0، 0، 0)؛
    جـتك.حـاوية.أضف(صندوق_الأزرار، زر_الخروج)؛

    جـتك.صـندوق.احشد_في_البداية(صندوق، لصيقة، 1، 0، 0)؛
    جـتك.صـندوق.احشد_في_البداية(صندوق، حقل، 1، 0، 0)؛
    جـتك.صـندوق.احشد_في_البداية(صندوق، صندوق_الأزرار، 1، 0، 0)؛

    جـتك.حـاوية.أضف(النافذة، صندوق)؛

    جـتك.ودجـة.أظهر_الكل(النافذة)؛
  }؛

  دالة قد_تغير_الحقل (قابل_للتعديل: مؤشر[جـتك.قـابل_للتعديل]، لصيقة: مؤشر[جـتك.لـصيقة]) {
    عرف معطى: صـحيح[64]؛
    إذا مـتم.نـص.امسح(جـتك.قـابل_للتعديل.هات_محارف(قابل_للتعديل، 0، -1)، "%d"، معطى~مؤشر) != 0 {
      عرف محارف: مصفوفة[محرف، 100]؛
      مـتم.نـص.عين(محارف~مؤشر، "مضروب %ld = %ld"، معطى، مـضروب.مضروب(معطى))؛
      جـتك.لـصيقة.عين_النص(لصيقة، محارف~مؤشر)؛
    }؛
  }؛

  دالة قد_نقر_زر_حول (عنصر: مؤشر[جـتك.ودجـة]، معلومات: مؤشر) {
    عرف حوارية: مؤشر[جـتك.حـوارية]؛
    حوارية = جـتك.حـوارية_رسالة.أنشئ(
      النافذة، 0، جـتك.صـنف_رسالة._معلومة_، جـتك.نـوع_الزر._أغلق_، "المضروب.\nتطوير: سرمد خالد عبد الله"
    )؛
    جـتك.حـوارية.شغل(حوارية)؛
    جـتك.ودجـة.مزق(حوارية)؛
  }؛

  دالة قد_نقر_زر_الخروج (عنصر: مؤشر[جـتك.ودجـة]، معلومات: مؤشر) {
    جـتك.ودجـة.مزق(النافذة)؛
  }؛
}؛


إذا الـعملية.عدد_المعطيات < 3 {
  // تشغيل واجهة المستخدم
  واجـهة.ابدأ()؛
} وإلا {
  عرف معطى: صـحيح[64]؛
  إذا مـتم.نـص.امسح(الـعملية.المعطيات~محتوى(الـعملية.عدد_المعطيات - 1)، "%d"، معطى~مؤشر) != 0 {
    // طباعة النتيجة مباشرة
    مـتم.طـرفية.اطبع("مضروب %ld = %ld\ج"، معطى، مـضروب.مضروب(معطى))؛
  } وإلا {
    // تنفيذ الاختبارات الآلية
    إذا مـضروب.اختبر_المضروب() == 0 {
      مـتم.طـرفية.اطبع("فشلت الاختبارات الآلية.\ج")؛
      اخرج(1)؛
    }
    // بناء ملف تنفيذي
    عرف تنفيذي: مؤشر[بـناء.تـنفيذي] = بـناء.تـنفيذي.أنشئ(واجـهة.ابدأ~شبم، الـعملية.المعطيات~محتوى(الـعملية.عدد_المعطيات - 1))؛
    بـناء.تـنفيذي.أضف_اعتمادية(تنفيذي، جـتك~شبم)؛
    إذا بـناء.تـنفيذي.أنتج(تنفيذي) {
      مـتم.طـرفية.اطبع("اكتمل البناء.\ج")؛
    } وإلا {
      مـتم.طـرفية.اطبع("فشل البناء.\ج")؛
      اخرج(1)؛
    }؛
  }؛
}؛

